salus_integration_legacy|invitations_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.invitations_salus_r`
salus_integration_legacy|accounts_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.accounts_salus_r`
salus_integration_legacy|whitelabels_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.whitelabels_salus_r`
salus_integration_legacy|credit_reports_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.credit_reports_salus_r`
salus_integration_legacy|commision-rules_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.commision-rules_salus_r`
salus_integration_legacy|clicks_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.clicks_salus_r`
salus_integration_legacy|applicants_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.applicants_salus_r`
salus_integration_legacy|tracking_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.tracking_salus_r`
salus_integration_legacy|applicant-loans_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.applicant-loans_salus_r`
salus_integration_legacy|applicant-jobs_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.applicant-jobs_salus_r`
salus_integration_legacy|bids_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.bids_salus_r`
salus_integration_legacy|applicant-accommodations_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.applicant-accommodations_salus_r`
salus_integration_legacy|clicks-applications_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.clicks-applications_salus_r`
salus_integration_legacy|applications_salus_r|SELECT *, False AS is_anonymised FROM `sambla-data-staging-compliance.salus_integration_legacy.applications_salus_r`
salus_group_integration|applicants_salus_incremental_r|WITH data_with_ssn_rules AS (SELECT *, CASE WHEN country_code= "SE" THEN LEFT(REGEXP_REPLACE(CAST(raw.ssn AS STRING), "[^0-9]", ""), 12) WHEN country_code= "NO" THEN LEFT(REGEXP_REPLACE(CAST(raw.ssn AS STRING), "[^0-9]", ""), 11) WHEN country_code= "DK" THEN LEFT(REGEXP_REPLACE(CAST(raw.ssn AS STRING), "[^0-9]", ""), 10) WHEN country_code= "FI" THEN LEFT(REGEXP_REPLACE(UPPER(CAST(raw.ssn AS STRING)), "[^0-9-+A-Z]", ""), 11) END AS ssn_clean FROM`data-domain-data-warehouse.salus_group_integration.applicants_salus_incremental_r` raw) SELECT CASE WHEN raw.firstname IS NOT NULL  AND raw.firstname <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.firstname AS STRING), VAULT.uuid)) ELSE CAST(raw.firstname AS STRING) END AS firstname, CASE WHEN raw.lastname IS NOT NULL  AND raw.lastname <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.lastname AS STRING), VAULT.uuid)) ELSE CAST(raw.lastname AS STRING) END AS lastname, CASE WHEN raw.email IS NOT NULL  AND raw.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.email AS STRING), VAULT.uuid)) ELSE CAST(raw.email AS STRING) END AS email, CASE WHEN raw.phone IS NOT NULL  AND raw.phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.phone AS STRING), VAULT.uuid)) ELSE CAST(raw.phone AS STRING) END AS phone, CASE WHEN raw.ssn IS NOT NULL  AND raw.ssn <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.ssn AS STRING), VAULT.uuid)) ELSE CAST(raw.ssn AS STRING) END AS ssn, CASE WHEN raw.address IS NOT NULL  AND raw.address <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.address AS STRING), VAULT.uuid)) ELSE CAST(raw.address AS STRING) END AS address, CASE WHEN raw.city IS NOT NULL  AND raw.city <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.city AS STRING), VAULT.uuid)) ELSE CAST(raw.city AS STRING) END AS city, CASE WHEN raw.zip IS NOT NULL  AND raw.zip <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.zip AS STRING), VAULT.uuid)) ELSE CAST(raw.zip AS STRING) END AS zip, raw.* EXCEPT(firstname, lastname, email, phone, ssn, address, city, zip),CASE WHEN (raw.ssn IS NOT NULL AND raw.ssn <> "" AND VAULT.uuid IS NOT NULL) OR LOWER(raw.ssn) =  "anonymized" THEN TRUE ELSE FALSE END AS is_anonymised FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
salus_group_integration|bids_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.bids_salus_incremental_r`
salus_group_integration|clicks_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.clicks_salus_incremental_r`
salus_group_integration|credit_reports_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.credit_reports_salus_incremental_r`
salus_group_integration|applicant-accommodations_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.applicant-accommodations_salus_incremental_r`
salus_group_integration|commision-rules_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.commision-rules_salus_incremental_r`
salus_group_integration|applications_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.applications_salus_incremental_r`
salus_group_integration|accounts_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.accounts_salus_incremental_r`
salus_group_integration|whitelabels_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.whitelabels_salus_incremental_r`
salus_group_integration|tracking_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.tracking_salus_incremental_r`
salus_group_integration|applicant-jobs_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.applicant-jobs_salus_incremental_r`
salus_group_integration|applicant-loans_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.applicant-loans_salus_incremental_r`
salus_group_integration|clicks-applications_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.clicks-applications_salus_incremental_r`
salus_group_integration|invitations_salus_incremental_r|SELECT *, False AS is_anonymised FROM `data-domain-data-warehouse.salus_group_integration.invitations_salus_incremental_r`