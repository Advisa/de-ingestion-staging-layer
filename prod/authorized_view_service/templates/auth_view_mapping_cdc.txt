sambla_group_data_stream|credit_report_service_credit_reports_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.credit_report_service_credit_reports_sgds_r` raw) SELECT STRUCT(raw.payload.has_debt_reconstruction, raw.payload.previous_capital_deficit, CASE WHEN raw.payload.secret_address IS NOT NULL  AND raw.payload.secret_address <> 0 AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.secret_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.secret_address AS STRING) END , raw.payload.fetched_at, raw.payload.blocked_description, raw.payload.customer_id, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END , CASE WHEN raw.payload.postal_code IS NOT NULL  AND raw.payload.postal_code <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postal_code AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postal_code AS STRING) END , raw.payload.trustee_appointed, raw.payload.taxed_year, raw.payload.minor, raw.payload.creditor_code, raw.payload.applicant_draft_id, raw.payload.previous_taxed_annual_income, CASE WHEN raw.payload.city IS NOT NULL  AND raw.payload.city <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.city AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.city AS STRING) END , raw.payload.unregistered, raw.payload.major_city_inhabitant, raw.payload.template_code, raw.payload.uc_registration_date, raw.payload.latest_payment_complaint, CASE WHEN raw.payload.temporary_address IS NOT NULL  AND raw.payload.temporary_address <> 0 AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.temporary_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.temporary_address AS STRING) END , raw.payload.capital_deficit, raw.payload.template_passed, raw.payload.no_visit_address, raw.payload.debt_reconciliation_date, raw.payload.previous_taxed_year, raw.payload.blocked_code, CASE WHEN raw.payload.xml IS NOT NULL  AND raw.payload.xml <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.xml AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.xml AS STRING) END , raw.payload.number_of_payment_complaints, raw.payload.number_of_reports_12_months, raw.payload.debt_balance, CASE WHEN raw.payload.street_address IS NOT NULL  AND raw.payload.street_address <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.street_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.street_address AS STRING) END , raw.payload.move_in_date, raw.payload.score, raw.payload.product_type, raw.payload.taxed_annual_income, raw.payload.country, CASE WHEN raw.payload.first_name IS NOT NULL  AND raw.payload.first_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.first_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.first_name AS STRING) END , CASE WHEN raw.payload.last_name IS NOT NULL  AND raw.payload.last_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.last_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.last_name AS STRING) END , raw.payload.payment_complaint, raw.payload.id) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|exp_bidding_service_bid_accepts_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_bid_accepts_sgds_r`
sambla_group_data_stream|exp_bidding_service_bid_additional_requirements_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_bid_additional_requirements_sgds_r`
sambla_group_data_stream|exp_bidding_service_bid_logs_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_bid_logs_sgds_r`
sambla_group_data_stream|exp_bidding_service_bidding_logs_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_bidding_logs_sgds_r`
sambla_group_data_stream|exp_bidding_service_bids_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_bids_sgds_r`
sambla_group_data_stream|exp_bidding_service_creditor_products_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_creditor_products_sgds_r`
sambla_group_data_stream|exp_bidding_service_creditors_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_creditors_sgds_r`
sambla_group_data_stream|exp_bidding_service_invite_logs_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_invite_logs_sgds_r`
sambla_group_data_stream|exp_bidding_service_invites_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_bidding_service_invites_sgds_r`
sambla_group_data_stream|exp_customer_service_customers_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.exp_customer_service_customers_sgds_r` raw) SELECT STRUCT(CASE WHEN raw.payload.postal_code IS NOT NULL  AND raw.payload.postal_code <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postal_code AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postal_code AS STRING) END , raw.payload.country, CASE WHEN raw.payload.street_address IS NOT NULL  AND raw.payload.street_address <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.street_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.street_address AS STRING) END , CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , raw.payload.updated_at, raw.payload.id, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END , CASE WHEN raw.payload.last_name IS NOT NULL  AND raw.payload.last_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.last_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.last_name AS STRING) END , raw.payload.created_at, raw.payload.birth_date, CASE WHEN raw.payload.city IS NOT NULL  AND raw.payload.city <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.city AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.city AS STRING) END , raw.payload.latest_credit_check_done_at, raw.payload.valid_national_id, CASE WHEN raw.payload.first_name IS NOT NULL  AND raw.payload.first_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.first_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.first_name AS STRING) END , raw.payload.marked_for_delete, CASE WHEN raw.payload.mobile_phone IS NOT NULL  AND raw.payload.mobile_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.mobile_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.mobile_phone AS STRING) END , raw.payload.move_in_date) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|exp_loan_application_service_applicant_drafts_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_applicant_drafts_sgds_r` raw) SELECT STRUCT(raw.payload.occupation_title, raw.payload.other_income_source, raw.payload.other_monthly_income_before_tax, raw.payload.num_household_adults, raw.payload.business_registration_date, raw.payload.other_monthly_income_after_tax, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END , raw.payload.monthly_income_after_tax, raw.payload.citizenship, raw.payload.has_foreign_currency_income, raw.payload.spouse_monthly_income_before_tax, raw.payload.employment_since, raw.payload.military_service_status, CASE WHEN raw.payload.business_organization_number IS NOT NULL  AND raw.payload.business_organization_number <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.business_organization_number AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.business_organization_number AS STRING) END , raw.payload.num_dependants, raw.payload.home_cost, raw.payload.employment_to, raw.payload.updated_at, raw.payload.home_type_category, raw.payload.num_household_adults_employed, raw.payload.monthly_income_before_tax, CASE WHEN raw.payload.mobile_phone IS NOT NULL  AND raw.payload.mobile_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.mobile_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.mobile_phone AS STRING) END , raw.payload.move_in_date, raw.payload.education_level, raw.payload.home_type, CASE WHEN raw.payload.employer_phone IS NOT NULL  AND raw.payload.employer_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.employer_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.employer_phone AS STRING) END , CASE WHEN raw.payload.employer_name IS NOT NULL  AND raw.payload.employer_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.employer_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.employer_name AS STRING) END , raw.payload.occupation_category, raw.payload.spouse_monthly_income_after_tax, raw.payload.other_living_cost, CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , raw.payload.monthly_child_alimony_cost, raw.payload.employment_type, raw.payload.rental_monthly_income_before_tax, raw.payload.monthly_rental_income, raw.payload.employment_industry, raw.payload.civil_status, CASE WHEN raw.payload.bank_account IS NOT NULL  AND raw.payload.bank_account <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.bank_account AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.bank_account AS STRING) END , raw.payload.id, raw.payload.has_credit_card, raw.payload.home_type_other_description, raw.payload.created_at) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|exp_loan_application_service_applicants_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_applicants_sgds_r` raw) SELECT STRUCT(raw.payload.occupation_title, CASE WHEN raw.payload.employer_name IS NOT NULL  AND raw.payload.employer_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.employer_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.employer_name AS STRING) END , raw.payload.other_income_source, raw.payload.id, raw.payload.is_politically_exposed, raw.payload.employment_type, raw.payload.applicant_draft_id, raw.payload.home_type, raw.payload.employment_to, CASE WHEN raw.payload.bank_account IS NOT NULL  AND raw.payload.bank_account <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.bank_account AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.bank_account AS STRING) END , CASE WHEN raw.payload.first_name IS NOT NULL  AND raw.payload.first_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.first_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.first_name AS STRING) END , raw.payload.updated_at, CASE WHEN raw.payload.last_name IS NOT NULL  AND raw.payload.last_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.last_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.last_name AS STRING) END , CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , raw.payload.employment_since, CASE WHEN raw.payload.employer_phone IS NOT NULL  AND raw.payload.employer_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.employer_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.employer_phone AS STRING) END , raw.payload.has_foreign_currency_income, raw.payload.birth_date, raw.payload.other_monthly_income_after_tax, raw.payload.monthly_income_after_tax, raw.payload.home_cost, raw.payload.spouse_monthly_income_before_tax, raw.payload.monthly_rental_income, raw.payload.num_dependants, raw.payload.eu_sanction_validated_at, raw.payload.move_in_date, raw.payload.other_living_cost, raw.payload.occupation_category, raw.payload.created_at, raw.payload.customer_id, raw.payload.military_service_status, CASE WHEN raw.payload.mobile_phone IS NOT NULL  AND raw.payload.mobile_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.mobile_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.mobile_phone AS STRING) END , raw.payload.num_household_adults_employed, raw.payload.spouse_monthly_income_after_tax, raw.payload.rental_monthly_income_before_tax, raw.payload.latest_credit_default, raw.payload.home_type_category, CASE WHEN raw.payload.city IS NOT NULL  AND raw.payload.city <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.city AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.city AS STRING) END , raw.payload.home_type_other_description, raw.payload.monthly_child_alimony_cost, raw.payload.other_monthly_income_before_tax, CASE WHEN raw.payload.postal_code IS NOT NULL  AND raw.payload.postal_code <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postal_code AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postal_code AS STRING) END , raw.payload.education_level, raw.payload.monthly_income_before_tax, raw.payload.employment_industry, CASE WHEN raw.payload.street_address IS NOT NULL  AND raw.payload.street_address <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.street_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.street_address AS STRING) END , CASE WHEN raw.payload.business_organization_number IS NOT NULL  AND raw.payload.business_organization_number <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.business_organization_number AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.business_organization_number AS STRING) END , raw.payload.has_credit_card, raw.payload.citizenship, raw.payload.num_household_adults, raw.payload.business_registration_date, raw.payload.civil_status, raw.payload.country, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END ) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|exp_loan_application_service_current_loan_drafts_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_current_loan_drafts_sgds_r`
sambla_group_data_stream|exp_loan_application_service_current_loans_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_current_loans_sgds_r`
sambla_group_data_stream|exp_loan_application_service_loan_application_drafts_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_loan_application_drafts_sgds_r`
sambla_group_data_stream|exp_loan_application_service_loan_application_versions_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_loan_application_versions_sgds_r`
sambla_group_data_stream|exp_loan_application_service_loan_applications_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_loan_application_service_loan_applications_sgds_r`
sambla_group_data_stream|exp_tracking_service_application_cookie_mappings_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_tracking_service_application_cookie_mappings_sgds_r`
sambla_group_data_stream|exp_tracking_service_cookies_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_tracking_service_cookies_sgds_r`
sambla_group_data_stream|exp_tracking_service_pageviews_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_tracking_service_pageviews_sgds_r`
sambla_group_data_stream|exp_tracking_service_query_params_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.exp_tracking_service_query_params_sgds_r`
sambla_group_data_stream|identity_verification_service_identity_verification_log_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.identity_verification_service_identity_verification_log_sgds_r`
sambla_group_data_stream|marketing_contact_service_cart_abandonment_contacts_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.marketing_contact_service_cart_abandonment_contacts_sgds_r` raw) SELECT STRUCT(raw.payload.page, CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , raw.payload.num_dependants, raw.payload.query_params, raw.payload.occupation_category, raw.payload.employment_to_month, raw.payload.consolidation_amount, raw.payload.employment_type, raw.payload.loan_purpose, raw.payload.employment_since, raw.payload.monthly_income_before_tax, CASE WHEN raw.payload.mobile_phone IS NOT NULL  AND raw.payload.mobile_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.mobile_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.mobile_phone AS STRING) END , raw.payload.monthly_salary, raw.payload.prefill_token, CASE WHEN raw.payload.business_organization_number IS NOT NULL  AND raw.payload.business_organization_number <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.business_organization_number AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.business_organization_number AS STRING) END , raw.payload.monthly_income_after_tax, raw.payload.total_amount, raw.payload.move_in_date, raw.payload.home_type_category, raw.payload.is_cart_abandonment, raw.payload.employment_industry, raw.payload.bloomreach_cookie, raw.payload.rental_monthly_income_before_tax, raw.payload.home_type, raw.payload.occupation_title, raw.payload.business_registration_date, raw.payload.internal_cookie, CASE WHEN raw.payload.employer_name IS NOT NULL  AND raw.payload.employer_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.employer_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.employer_name AS STRING) END , raw.payload.merge_loan, raw.payload.site_origin, raw.payload.id, raw.payload.other_monthly_income_before_tax, raw.payload.employment_since_month, raw.payload.spouse_monthly_income_before_tax, raw.payload.education_level, raw.payload.created_at, raw.payload.other_income_source, raw.payload.home_cost, raw.payload.military_service_status, raw.payload.updated_at, raw.payload.employment_to, raw.payload.repayment_time, raw.payload.other_monthly_income_after_tax, raw.payload.civil_status, raw.payload.citizenship, raw.payload.accept_news_letter, raw.payload.other_income, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END ) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|marketing_contact_service_contact_blocks_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.marketing_contact_service_contact_blocks_sgds_r`
sambla_group_data_stream|marketing_contact_service_contact_tokens_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.marketing_contact_service_contact_tokens_sgds_r`
sambla_group_data_stream|marketing_contact_service_contacts_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.marketing_contact_service_contacts_sgds_r` raw) SELECT STRUCT(raw.payload.last_application_employer_name, raw.payload.last_application_accepted, raw.payload.customer_sendouts_block_until, CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , raw.payload.last_application_business_organization_number, raw.payload.ppi_deactivated_at, raw.payload.last_application_spouse_monthly_income_before_tax, raw.payload.last_application_employment_industry, raw.payload.last_accepted_at, raw.payload.last_application_num_invited_creditors, raw.payload.last_application_num_dependants, raw.payload.last_application_granted, CASE WHEN raw.payload.city IS NOT NULL  AND raw.payload.city <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.city AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.city AS STRING) END , raw.payload.last_application_employment_to, raw.payload.last_application_occupation_title, raw.payload.infocom_consent, raw.payload.last_application_desired_repayment_time, CASE WHEN raw.payload.postal_code IS NOT NULL  AND raw.payload.postal_code <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postal_code AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postal_code AS STRING) END , raw.payload.site_origin, raw.payload.last_application_home_type_category, raw.payload.last_application_home_type, CASE WHEN raw.payload.mobile_phone IS NOT NULL  AND raw.payload.mobile_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.mobile_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.mobile_phone AS STRING) END , raw.payload.last_application_purpose, raw.payload.online_interest_watch, raw.payload.last_application_lowest_apr, raw.payload.last_application_monthly_income_after_tax, raw.payload.last_application_initial_marketing_consent, raw.payload.last_application_military_service_status, raw.payload.last_application_citizenship, raw.payload.last_application_total_loan, raw.payload.last_application_paid, raw.payload.last_application_has_co_applicant, raw.payload.last_application_business_registration_date, raw.payload.last_application_education_level, raw.payload.last_application_employment_since, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END , raw.payload.last_application_move_in_date, raw.payload.last_application_completed, raw.payload.last_paid_at, raw.payload.last_application_civil_status, CASE WHEN raw.payload.last_name IS NOT NULL  AND raw.payload.last_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.last_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.last_name AS STRING) END , raw.payload.last_application_home_cost, raw.payload.created_at, raw.payload.ppi, raw.payload.last_application_uc_score, raw.payload.last_application_monthly_income_before_tax, raw.payload.last_application_is_co_applicant, raw.payload.last_paid_creditor_product, raw.payload.creditor_block_until, raw.payload.last_application_debt_balance, raw.payload.last_application_rental_monthly_income_before_tax, raw.payload.last_application_num_bids, raw.payload.last_application_employer_phone, raw.payload.last_application_other_monthly_income_after_tax, raw.payload.last_application_granted_amount, raw.payload.last_application_employment_type, raw.payload.last_application_other_income_source, CASE WHEN raw.payload.first_name IS NOT NULL  AND raw.payload.first_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.first_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.first_name AS STRING) END , raw.payload.interest_watch, raw.payload.last_application_id, raw.payload.last_application_payment_complaint, raw.payload.has_been_primary_applicant, raw.payload.last_application_other_monthly_income_before_tax, raw.payload.total_num_applications, raw.payload.last_application_created_at, raw.payload.last_application_new_loan, raw.payload.updated_at, raw.payload.last_application_occupation_category, raw.payload.marketing_consent_expires_at, raw.payload.id) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|marketing_contact_service_fully_blocked_contacts_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.marketing_contact_service_fully_blocked_contacts_sgds_r` raw) SELECT STRUCT(raw.payload.telemarketing, raw.payload.updated_at, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END , CASE WHEN raw.payload.mobile_phone IS NOT NULL  AND raw.payload.mobile_phone <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.mobile_phone AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.mobile_phone AS STRING) END , raw.payload.id, raw.payload.push_notifications, raw.payload.other_info, raw.payload.created_at, raw.payload.block_reason, CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , raw.payload.block_expiration) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|marketing_contact_service_mortgage_cart_abandonment_contacts_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.marketing_contact_service_mortgage_cart_abandonment_contacts_sgds_r`
sambla_group_data_stream|payments_api_Customer_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.nationalId AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.payments_api_Customer_sgds_r` raw) SELECT STRUCT(CASE WHEN raw.payload.address IS NOT NULL  AND raw.payload.address <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.address AS STRING) END , raw.payload.market, CASE WHEN raw.payload.email IS NOT NULL  AND raw.payload.email <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.email AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.email AS STRING) END , CASE WHEN raw.payload.postalArea IS NOT NULL  AND raw.payload.postalArea <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postalArea AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postalArea AS STRING) END , CASE WHEN raw.payload.phoneNumber IS NOT NULL  AND raw.payload.phoneNumber <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.phoneNumber AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.phoneNumber AS STRING) END , raw.payload.payerNumber, raw.payload.updatedAt, raw.payload.migratedFromInsivoAt, raw.payload.createdAt, raw.payload.id, CASE WHEN raw.payload.name IS NOT NULL  AND raw.payload.name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.name AS STRING) END , CASE WHEN raw.payload.postcode IS NOT NULL  AND raw.payload.postcode <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postcode AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postcode AS STRING) END , CASE WHEN raw.payload.nationalId IS NOT NULL  AND raw.payload.nationalId <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.nationalId AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.nationalId AS STRING) END ) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|payments_api_InvoiceFile_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_InvoiceFile_sgds_r`
sambla_group_data_stream|payments_api_InvoiceItem_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_InvoiceItem_sgds_r`
sambla_group_data_stream|payments_api_Invoice_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_Invoice_sgds_r`
sambla_group_data_stream|payments_api_PaymentDetail_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_PaymentDetail_sgds_r`
sambla_group_data_stream|payments_api_PaymentEvent_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_PaymentEvent_sgds_r`
sambla_group_data_stream|payments_api_Payment_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_Payment_sgds_r`
sambla_group_data_stream|payments_api_Price_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_Price_sgds_r`
sambla_group_data_stream|payments_api_Product_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_Product_sgds_r`
sambla_group_data_stream|payments_api_RecurringPaymentEvent_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_RecurringPaymentEvent_sgds_r`
sambla_group_data_stream|payments_api_RecurringPayment_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api_RecurringPayment_sgds_r`
sambla_group_data_stream|uc_service_credit_reports_sgds_r|WITH data_with_ssn_rules AS (SELECT *, LEFT(REGEXP_REPLACE(CAST(raw.payload.national_id AS STRING), "[^0-9]", ""), 12) AS ssn_clean FROM`data-domain-data-warehouse.sambla_group_data_stream.uc_service_credit_reports_sgds_r` raw) SELECT STRUCT(raw.payload.fetched_at, raw.payload.number_of_reports_12_months, CASE WHEN raw.payload.last_name IS NOT NULL  AND raw.payload.last_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.last_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.last_name AS STRING) END , raw.payload.blocked_code, raw.payload.minor, raw.payload.taxed_year, raw.payload.trustee_appointed, raw.payload.unregistered, raw.payload.has_debt_reconstruction, raw.payload.payment_complaint, raw.payload.latest_payment_complaint, raw.payload.customer_id, CASE WHEN raw.payload.temporary_address IS NOT NULL  AND raw.payload.temporary_address <> 0 AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.temporary_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.temporary_address AS STRING) END , CASE WHEN raw.payload.first_name IS NOT NULL  AND raw.payload.first_name <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.first_name AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.first_name AS STRING) END , raw.payload.debt_balance, raw.payload.score, raw.payload.taxed_annual_income, raw.payload.capital_deficit, raw.payload.id, raw.payload.number_of_payment_complaints, raw.payload.major_city_inhabitant, raw.payload.uc_registration_date, raw.payload.previous_capital_deficit, CASE WHEN raw.payload.xml IS NOT NULL  AND raw.payload.xml <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.xml AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.xml AS STRING) END , raw.payload.no_visit_address, CASE WHEN raw.payload.city IS NOT NULL  AND raw.payload.city <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.city AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.city AS STRING) END , raw.payload.template_passed, CASE WHEN raw.payload.secret_address IS NOT NULL  AND raw.payload.secret_address <> 0 AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.secret_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.secret_address AS STRING) END , raw.payload.previous_taxed_annual_income, raw.payload.creditor_code, raw.payload.country, raw.payload.previous_taxed_year, raw.payload.template_code, CASE WHEN raw.payload.street_address IS NOT NULL  AND raw.payload.street_address <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.street_address AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.street_address AS STRING) END , raw.payload.applicant_draft_id, raw.payload.blocked_description, CASE WHEN raw.payload.postal_code IS NOT NULL  AND raw.payload.postal_code <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.postal_code AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.postal_code AS STRING) END , raw.payload.debt_reconciliation_date, CASE WHEN raw.payload.national_id IS NOT NULL  AND raw.payload.national_id <> '' AND VAULT.uuid IS NOT NULL THEN TO_HEX(SAFE.DETERMINISTIC_ENCRYPT(VAULT.aead_key, CAST(raw.payload.national_id AS STRING), VAULT.uuid)) ELSE CAST(raw.payload.national_id AS STRING) END , raw.payload.product_type) ASpayload, raw.* EXCEPT(payload) FROM `data_with_ssn_rules` raw LEFT JOIN `sambla-group-compliance-db.compilance_database.gdpr_vault_rudolf` VAULT ON CAST(raw.ssn_clean AS STRING) = VAULT.ssn
sambla_group_data_stream|payments_api__PaymentToProduct_sgds_r|SELECT * FROM `data-domain-data-warehouse.sambla_group_data_stream.payments_api__PaymentToProduct_sgds_r`
